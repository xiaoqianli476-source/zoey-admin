<template>
    <div class="login">
        <div class="flex">
            <div class="w-3/5 bg-red-50 h-100vh p-15px">
                <div class="flex">
                    <img class="w-45px" src="../../assets/img/e3f2df3f-7dc7-4dd1-9b69-5fe3b9711e46.png" alt="">
                    <h1 class=" ml-10px text-xl leading-40px">Art Design Pro</h1>
                </div>
                <div class="w-40% mx-auto h-80vh bg-amber-700"><svg viewBox="0 0 400 300" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="44" y="42" width="312"
                            height="217">
                            <path d="M355.3 42H44v216.9h311.3V42Z" fill="var(--art-main-bg-color)"></path>
                        </mask>
                        <g mask="url(#a)">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M288.2 248.4h25.1v-30h-25.1v30Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M304.498 238.199c-1.5-3.9-5.9-15.4-4-21.6-2.9.8-3.3.1-5-.1-1.7-.1 0 10.7 2.2 16.4 1.7 4.5 2.1 11.1 2.1 13.6h5.4c.2-1.9.3-5.5-.7-8.3Z"
                                fill="var(--art-main-bg-color)"></path>
                            <path d="M311.5 214.7v-1.6c0-.7-.6-1.3-1.3-1.3h-22.8c-.7 0-1.3.6-1.3 1.3v1.6"
                                fill="var(--art-main-bg-color)"></path>
                            <path
                                d="M311.5 214.7v-1.6c0-.7-.6-1.3-1.3-1.3h-22.8c-.7 0-1.3.6-1.3 1.3v1.6M290.2 214.7h21.4c1 0 1.8.8 1.8 1.8v29"
                                stroke="var(--el-color-primary-dark-2)" stroke-width="1.096"></path>
                            <path d="M284.3 245.6v-29c0-1 .8-1.8 1.8-1.8h1.6" fill="var(--art-main-bg-color)"></path>
                            <path d="M284.3 245.6v-29c0-1 .8-1.8 1.8-1.8h1.6" stroke="var(--el-color-primary-dark-2)"
                                stroke-width="1.096"></path>
                            <path
                                d="M295.402 216.5c-.9 4.2-.4 9.7 2.8 17.5 2.4 5.9 1.9 10.2 1.8 12.3M300.502 216.5c-.9 4.2-.4 9.7 2.8 17.5 2.4 5.9 1.9 10.2 1.8 12.3"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="m331 258.4-.3-5.2H88.5l-1.2 5.2H331Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path d="M252.9 248.7H331M216.6 258.4H331M47.1 139.3l-2.6 1.5 42.7 117.6h129.2v-6.6"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="m247.2 248.6-40.4-111.3H50.5l40.3 111.3h156.4Z" fill="var(--art-main-bg-color)">
                            </path>
                            <path d="m247.2 248.6-40.4-111.3H50.5l40.3 111.3h156.4Z"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path d="m203.2 153.2 32.2 88.7H97.8l-32.3-88.7" stroke="var(--el-color-primary-dark-2)">
                            </path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M72.2 146.9c-.77 0-1.4.63-1.4 1.4 0 .77.63 1.4 1.4 1.4.77 0 1.4-.63 1.4-1.4 0-.77-.63-1.4-1.4-1.4ZM79.3 146.9c-.77 0-1.4.63-1.4 1.4 0 .77.63 1.4 1.4 1.4.77 0 1.4-.63 1.4-1.4 0-.77-.63-1.4-1.4-1.4Z"
                                fill="var(--art-main-bg-color)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M263.5 171.2h80.3v-63.7h-80.3v63.7Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M290 143.9h-45.6l12.5 51.3H290v-51.3Z"
                                fill="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M286 117.4h-29.3v77.8h92.9v-67.6l-55.9.6-7.7-10.8Z"
                                fill="var(--el-color-primary-light-1)"></path>
                            <path
                                d="m332.6 127.6-38.9.6-7.7-10.8h-11.7M308.9 195.2h45.9M250.3 195.2h28.5M287.3 195.2h12.3"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M130.5 211.4H186v-44h-55.5v44Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M148.7 192.5h-31.6l8.7 35.5h22.9v-35.5Z"
                                fill="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M145.9 174.2h-20.2V228h64.1v-46.7l-38.6.4-5.3-7.5Z" fill="var(--el-color-primary)">
                            </path>
                            <path
                                d="m179 181.3-27.8.4-5.3-7.5h-7.7M176.2 201.7h19.2M163.2 210.7H195M172.1 228h-54.2M184.8 228h8.1M174.9 228h5.4"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="m293.2 155.7-6.4 6.3 15.3 15.3 22.7-22.6-6.4-6.4-16.3 16.3-8.9-8.9Z"
                                fill="var(--art-main-bg-color)"></path>
                            <path
                                d="M57.2 258.4h283.6M345.9 258.4h8.1M55.4 258.4h220.5M160.1 118.8l-1.2 2.7M156.7 127c-.3.8-.7 1.8-1.1 2.8M222 68.5c-1 .2-1.9.5-2.9.8M214.1 70.7c-5.8 1.9-11.3 4.4-16.5 7.4M195.4 79.5c-.9.5-1.7 1.1-2.5 1.6M314.2 98.5c-.6-.8-1.3-1.5-2-2.3M308.9 92.8c-4-4-8.3-7.6-13-10.8M293.9 80.7c-.8-.5-1.7-1.1-2.5-1.6"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M251.296 71.203c-3.6-1.5-18.5-2.9-21.8-1.9-1 5.8 4.9 13.5 4.9 13.5s6-9.9 16.9-11.6Z"
                                fill="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M251.3 42.704c-6.5 6.7-7.8 13-8.8 19.3 24.4-1.1 36.3 13 42.8 20 3.2-9.1 7.8-23 7.2-29-7.1-6.4-20-11.7-41.2-10.3Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path
                                d="M230 69.3c36.2-3.8 52 21.1 52 21.1s11.4-28.2 10.5-37.4c-7.3-6.5-23.3-12-45.6-10.1-9 6.3-15.6 18.7-16.9 26.4Z"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M161.604 70.7c-6 8.4-9.9 21.9-8.8 33.8 8.4 5.3 32.3 10.5 43.6 11.5 6.1-7.9 15.9-26 15.9-26s-32-4.8-50.7-19.3Z"
                                fill="var(--el-color-primary-light-6)"></path>
                            <path
                                d="M193.103 119.5c4.8-2.7 19.2-29.5 19.2-29.5s-35.8-5.4-53.7-21.8c-9.3 6.1-16.4 24.3-15 40.1 10.6 6.7 45.8 13.3 49.5 11.2Z"
                                stroke="var(--el-color-primary-dark-2)"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M189.5 111.6c-3 5.2-5.7 7.2-9.8 6.6 12.2 2.6 13.5 1.2 15.6-1.1 2.2-2.4 4.2-6.6 4.2-6.6s-3.1 2.5-10 1.1Z"
                                fill="var(--el-color-primary-dark-2)"></path>
                            <path d="M331 251.8v6.6M77 165.4l-2.7-6.7h7.8M222.8 228.9l2.8 6.6h-7.9"
                                stroke="var(--el-color-primary-dark-2)"></path>
                        </g>
                    </svg></div>
                <h1 class="text-center text-2xl font-medium">专注于用户体验的后台管理系统模版</h1>
                <h1 class="text-center font-thin mt-10px text-sm ">美观实用的界面，经过视觉优化，确保卓越的用户体验</h1>
            </div>
            <div class="w-2/5 bg-stone-300  p-20px">
                <div class=" flex justify-end ">
                    <div class="ml-15px p-5px"><el-icon>
                            <Moon />
                        </el-icon></div>
                    <div class="ml-15px p-5px"><el-icon>
                            <PictureRounded />
                        </el-icon></div>
                </div>
                <div class="pt-40px pb-40px h-full flex items-center justify-center">
                    <div class="h-400px w-95%">
                        <h1> 欢迎回来</h1>
                        <div class="pt-10px">输入您的账号和密码登录</div>

                        <el-form ref="ruleFormRef" :model="ruleForm" :rules="rules" class="demo-ruleForm"
                            :size="formSize" status-icon>
                            <div class="mt-25px">
                                <el-form-item prop="region" class="w-100% mb-20px !ml-0">
                                    <el-select v-model="ruleForm.region" placeholder="超级管理员" @change="handleChange">
                                        <el-option v-for="item in options" :key="item.value" :label="item.label"
                                            :value="item.value" />
                                    </el-select>
                                </el-form-item>
                                <el-form-item prop="name">
                                    <el-input v-model="ruleForm.name" placeholder="请输入昵称" />
                                </el-form-item>
                                <el-form-item prop="password">
                                    <el-input v-model="ruleForm.password" type="password" placeholder="输入密码"
                                        show-password />
                                </el-form-item>
                                <div class="flex justify-between mt10">
                                    <div class="flex items-center"> <el-checkbox v-model="checked1" label="记住密码"
                                            size="large" />
                                    </div>
                                    <el-link :underline="false">忘记密码</el-link>
                                </div>
                                <el-button type="primary" class="w-100% pt-10px"
                                    @click="submitForm(ruleFormRef)">登录</el-button>
                                <div class="text-sm flex items-center mt-10px ">还没有账号? <el-link class="ml-5px"
                                        :underline="false" type="primary">注册</el-link></div>
                            </div>
                        </el-form>
                    </div>
                </div>
                <div>

                </div>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { useRouter } from 'vue-router'
import { reactive, ref } from 'vue'
import type { FormInstance, FormRules } from 'element-plus'
import { ElMessage } from 'element-plus'
import axios from "axios"


const options = [
    {
        value: 'super',
        label: '超级管理员',
        password: '123456',
        username: 'super'
    },
    {
        value: 'admin',
        label: '管理员',
        password: '123456',
        username: 'admin'
    },
    {
        value: 'user',
        label: '普通用户',
        password: '123456',
        username: 'user'
    }
]


// 获取路由实例
const router = useRouter()

function backToHome() {
    router.push('/')
}
function handleChange(e) {
    const matchedOption = options.find(option => option.value === e);
    if (matchedOption) {
        // 直接从匹配到的项中获取username字段的值设置ruleForm.name
        ruleForm.name = matchedOption.username;
    }
}

const checked1 = ref(true)
const formSize = ref('default')
const ruleFormRef = ref<FormInstance>()
const ruleForm = reactive({
    name: '',
    region: '',
    password: '',
})

const rules = reactive<FormRules>({
    name: [
        { required: true, message: '用户名不能为空!', trigger: 'blur' },
        { min: 3, max: 8, message: '长度需在 3 到 5 个字符之间', trigger: 'blur' },
    ],
    region: [
        {
            required: true,
            message: '请选择',
            trigger: 'change',
        },
    ],
    password: [
        {
            required: true,
            message: '密码不能为空',
            trigger: 'change',
        },
    ],

})


const submitForm = async (formEl: FormInstance | undefined) => {
    if (!formEl) return
    await formEl.validate((valid, fields) => {
        if (valid) {
            // 发起一个post请求
            axios({
                method: 'post',
                url: 'https://mock.apifox.cn/m1/3109515-0-default/auth/login',
                headers: { apifoxtoken: "XL299LiMEDZ0H5h3A29PxwQXdMJqWyY2" },
                data: {
                    userName: ruleForm.name,
                    password: ruleForm.password

                }
            }).then(res => {
                if (res.data.code !== "0000") {
                    ElMessage.error(res.data.msg)
                    return
                }
                localStorage.setItem("token", res.data.data.token)

                // 发起一个post请求
                axios({
                    method: 'get',
                    url: 'https://mock.apifox.cn/m1/3109515-0-default/auth/getUserInfo',
                    headers: { apifoxtoken: "XL299LiMEDZ0H5h3A29PxwQXdMJqWyY2", authorization: `Bearer ${res.data.data.token}` },

                }).then(res => {
                    console.log('res', res)
                })
                backToHome()
            }).catch(err => {
                ElMessage.error()
                console.log(err)
            });
        } else {
            console.log('error submit!', fields)
        }
    })
}


</script>

<style></style>